<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>
Apache Traffic Server Reverse Proxy &middot; siwu&#x27;s blog
</title>
    <link rel="stylesheet" href="https://gaxxx.github.io/slim.css">
    
    
</head>

<body>
    <div class="container">
        
<div class="header">
    <h1 class="site-title"><a href="https:&#x2F;&#x2F;gaxxx.github.io">siwu&#x27;s blog</a></h1>
    <input id="search" class=".next" type="search" placeholder="Search" />
    <p class="site-tagline"></p>
    <div class="nav">
        <a class="nav-btn" href="#">
            <span class="ci ci-burger"></span>
        </a>
        <ul class="nav-list">
            
            
            <li><a href="https:&#x2F;&#x2F;gaxxx.github.io&#x2F;tags">Tags</a></li>
            
            
            <li class="spacer">&ac;</li>
            
            
            <li><a href="https://www.linkedin.com/in/gaxxx">LinkedIn</a></li>
            
            <li><a href="https://github.com/gaxxx">Github</a></li>
            
            
        </ul>
    </div>
    <div class="search-results">
    <ul class="search-results__items"></ul>
    </div>

</div>

        <div class="content">
            <div class="posts">
                
<div class="post">
    
    
<h2 class="post-title"><a href="https:&#x2F;&#x2F;gaxxx.github.io&#x2F;atsfan-xiang-dai-li&#x2F;">Apache Traffic Server Reverse Proxy</a></h2>
<div class="post-header">
    <span class="post-date">July 25, 2014</span>
    
    <div class="post-tags">
        
        <span class="post-tag">#<a href="https://gaxxx.github.io/tags/cdn/">cdn</a></span>
        
    </div>
    
</div>

    

  
    
  
    
    <a class="lang-toggle" href="https:&#x2F;&#x2F;gaxxx.github.io&#x2F;zh&#x2F;atsfan-xiang-dai-li&#x2F;">
      中文
    </a>
    
  


    <div class="post-content">
        <p>A high-performance CDN server from Apache, with use cases including:
<a rel="external" href="http://www.bizety.com/2014/02/23/comcasts-internal-cdn/">Comcast</a>
<a rel="external" href="http://www.infoq.com/cn/presentations/apache-traffic-server-and-cdn-practice">Taobao</a></p>
<span id="continue-reading"></span><h2 id="installation">Installation</h2>
<p>Ubuntu:
apt-get install trafficserver</p>
<p>Manual:
https://docs.trafficserver.apache.org/en/latest/admin/getting-started.en.html</p>
<h2 id="configure-debug-parameters">Configure Debug Parameters</h2>
<pre><code>//Add VIA field for debugging
traffic_line -s  proxy.config.http.insert_response_via_str -v 2
traffic_line -s  proxy.config.http.insert_request_via_str -v 1

//Modify default cache policy
traffic_line -s proxy.config.http.cache.required_headers -v 0

//Commit changes
traffic_line -x
</code></pre>
<h2 id="configure-sites-to-accelerate">Configure Sites to Accelerate</h2>
<pre><code>//Configure remap.config, default ATS port is 8080
//To accelerate mirrors.163.com
//Local mirror address is mirrors.gaxxx.me
map http://mirrors.gaxxx.me:8080/ http://mirrors.163.com/
</code></pre>
<h2 id="test-configuration">Test Configuration</h2>
<pre><code>curl http://mirrors.gaxxx.me:8080/  2&gt;&amp;1 | less
</code></pre>
<p>You can see:
Via: http/1.1 tv140002 (ApacheTrafficServer/5.1.0 [cRs f ])</p>
<p>//Check VIA codes, cache hit in memory</p>
<pre><code>traffic_line --decode_via  &quot;cRs f&quot;
Via Header Details:
Result of Traffic Server cache lookup for URL          :in cache, fresh Ram hit (a cache &quot;HIT&quot;)
Response information received from origin server       :no server connection needed
Result of document write-to-cache:                     :no cache write performed
</code></pre>
<h2 id="common-commands">Common Commands</h2>
<pre><code>trafficserver    ATS server run script
traffic_line     Configure ATS, reload ATS service
traffic_logstats ATS log viewer, check cache hits etc.
</code></pre>
<h2 id="cluster-control">Cluster Control</h2>
<p>ATS has two cluster modes: Manager Only and Full Cluster</p>
<ul>
<li>ManagerOnly: Syncs configuration files, each node's cache is separate</li>
<li>Full Cluster: All nodes' caches are merged into one logical cache; nodes may transfer cache objects over the network, requiring high internal network bandwidth</li>
</ul>
<p><a rel="external" href="https://docs.trafficserver.apache.org/en/latest/admin/cluster-howto.en.html">Configuration guide</a></p>
<h2 id="log-management">Log Management</h2>
<p>ATS has an independent logging system, similar to nginx, with error logs (error.log), event logs (access.log), and system logs (message.log). It can also generate summary logs based on configuration.</p>
<p>For log formats, you can use the common Squid format or ATS's custom XML format. Storage types can be binary or ASCII, with logrotate support.</p>
<p>Supports clustered log deployment.</p>
<p>See <a rel="external" href="https://docs.trafficserver.apache.org/en/latest/admin/working-log-files.en.html">ATS Logging</a> for details.</p>
<h2 id="cache-management">Cache Management</h2>

    </div>
    
</div>

            </div>
            
        </div>
        
<div class="footer">
    
    <p>Powered by <a href="https://getzola.org">Zola</a></p>
    
</div>

    </div>
    <script src="https://gaxxx.github.io/js/slim.js"></script>
    <script src="https://gaxxx.github.io/js/elasticlunr.min.js"></script>
    <script src="https://gaxxx.github.io/search_index.en.js"></script>
    <script src="https://gaxxx.github.io/js/lunr.stemmer.support.js"></script>
    <script src="https://gaxxx.github.io/js/lunr.en.js"></script>
    <script src="https://gaxxx.github.io/js/search.js"></script>
    
</body>

</html>
